#  Template NodeJS build

#  This template allows you to validate your NodeJS code.
#  The workflow allows running tests and code linting on the default branch.

pipelines:
  branches:
    main:
      - step:
          name: Build and Test
          image: node:20.12.2
          script:
            - npm install
            - npm run build
          artifacts:
            - out/**
      - step:
          name: Deployment to Staging
          image: atlassian/default-image:2
          deployment: Staging
          script:
            - pipe: atlassian/rsync-deploy:0.4.4
              variables:
                USER: $RSYNC_USRE
                SERVER: $RSYNC_SERVER
                REMOTE_PATH: $RSYNC_REMOTE_PATH
                LOCAL_PATH: ./out/
                DEBUG: 'true'
                SSH_PORT: $RSYNC_SSH_PORT
                EXTRA_ARGS: $RSYNC_EXTRA_ARGS
