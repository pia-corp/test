name: Comment opening announce

on:
  workflow_call:

jobs:
  comment_opening_announce:
    runs-on: ubuntu-latest
    timeout-minutes: 5

    permissions:
      pull-requests: write

    steps:
      - name: Set up opening announce
        id: opening_announce
        run: |
          lf='\n'
          message="@${{ github.event.pull_request.user.login }} さん、プルリクエストを受け付けました！ :tada:"
          message+="${lf}${lf}デプロイは下記の手順で行ってください。"
          message+="${lf}1. リリース予定の\`develop\`ブランチを\`main\`ブランチにマージします。"
          message+="${lf}2. コードオーナーの承認を受ける前にチェックを通過していることを確認してください。"
          message+="${lf}    - \`linter\`に合格しなかった場合は、原因を特定して手順2からやり直してください。"
          message+="${lf}    - HTMLのMarkupルールは[ドキュメント](https://github.com/pia-corp/test/blob/main/doc/markup_rule.md)を確認してください。"
          message+="${lf}    - \`approve\`された場合、\`main\`ブランチにマージします。"
          echo "message=${message}" >> $GITHUB_OUTPUT

      - name: Comment opening announce
        uses: actions/github-script@v7.0.1
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const params = {
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.pull_request.number,
              body: '${{ steps.opening_announce.outputs.message }}'
            }
            await github.rest.issues.createComment(params)
